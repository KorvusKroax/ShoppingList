security:
    # --- 1. PASSWORD HASHERS ---
    password_hashers:
        # A felhasználó entitásod (App\Entity\User) meg kell feleljen ennek az interfésznek
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'

    # --- 2. PROVIDERS: Honnan töltjük be a felhasználókat ---
    providers:
        # Itt megadjuk, hogy a felhasználókat a saját User entitásunkból töltjük be,
        # az email mezőt használva bejelentkezési azonosítóként.
        app_user_provider:
            entity:
                class: App\Entity\User
                property: email

    # --- 3. FIREWALLS: Tűzfalak beállítása ---
    firewalls:
        # Fejlesztői környezet (debug, profiler) - kihagyjuk a security ellenőrzést
        dev:
            pattern: ^/(_profiler|_wdt|/css|/images|/js)/
            security: false

        # API FIREWALL: Minden /api/ kezdetű kérés
        api:
            pattern: ^/api
            stateless: true
            provider: app_user_provider

            # --- VÁLTOZTATÁS ITT! jwt_json_login HELYETT json_login ---
            json_login: # <<< Ezt használd!
                check_path: /api/login_check
                username_path: email
                password_path: password
                # A Lexik Bundle sikeres kezelőjét rendeljük hozzá
                success_handler: lexik_jwt_authentication.handler.authentication_success
                failure_handler: lexik_jwt_authentication.handler.authentication_failure

            # A JWT ellenőrzés mechanizmusa
            jwt: ~
            entry_point: jwt

    # --- 4. ACCESS CONTROL: Jogosultsági szabályok ---
    access_control:
        # Engedélyezzük az anonim hozzáférést a bejelentkezési útvonalhoz,
        # különben senki nem tudna bejelentkezni.
        - { path: ^/api/login_check, roles: PUBLIC_ACCESS }
        # Minden más /api/ kezdetű útvonalhoz (a login_check kivételével)
        # TELJESEN HITELLESÍTETT felhasználó szükséges.
        - { path: ^/api, roles: IS_AUTHENTICATED_FULLY }

when@test:
    security:
        password_hashers:
            # Tesztekhez kisebb terhelésű hashelést használunk
            Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
                algorithm: auto
                cost: 4
                time_cost: 3
                memory_cost: 10
